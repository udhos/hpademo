<html>
    <head>
        <meta charset="utf-8"/>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="wasm_exec.js"></script>
        <script>
            const go = new Go();
            WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
                go.run(result.instance);
            });

            // Dark mode toggle
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('darkMode', isDark);
                updateDarkModeButton(isDark);
            }

            function updateDarkModeButton(isDark) {
                const btn = document.getElementById('darkModeToggle');
                btn.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            }

            // Carregar prefer√™ncia salva
            window.addEventListener('DOMContentLoaded', () => {
                // MUDAN√áA: Se n√£o houver prefer√™ncia salva, usa dark mode como padr√£o
                const savedMode = localStorage.getItem('darkMode');
                const isDark = savedMode === null ? true : savedMode === 'true';
                
                if (isDark) {
                    document.body.classList.add('dark-mode');
                }
                updateDarkModeButton(isDark);
            });
        </script>
        <style>
            /* Tema claro - Cinza Neutro */
            body {
                transition: background-color 0.3s, color 0.3s;
            }

            body:not(.dark-mode) {
                background: linear-gradient(135deg, #64748b 0%, #475569 100%) !important;
            }

            body:not(.dark-mode) .text-purple-600 {
                color: #334155 !important;
            }

            body:not(.dark-mode) .bg-purple-100 {
                background-color: #f1f5f9 !important;
            }

            body:not(.dark-mode) .text-purple-800 {
                color: #1e293b !important;
            }

            body:not(.dark-mode) .border-purple-500 {
                border-color: #64748b !important;
            }

            body:not(.dark-mode) #darkModeToggle {
                background: #475569 !important;
            }

            /* Tema escuro */
            body.dark-mode {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%) !important;
            }

            body.dark-mode .bg-white {
                background-color: #2d2d44 !important;
                color: #e0e0e0 !important;
            }

            body.dark-mode .text-purple-600 {
                color: #a78bfa !important;
            }

            body.dark-mode .text-gray-600 {
                color: #d1d5db !important;
            }

            body.dark-mode .bg-blue-50 {
                background-color: #1e3a5f !important;
            }

            body.dark-mode .border-blue-500 {
                border-color: #60a5fa !important;
            }

            body.dark-mode .text-blue-600 {
                color: #60a5fa !important;
            }

            body.dark-mode .text-blue-800:hover {
                color: #93c5fd !important;
            }

            body.dark-mode .bg-gray-50 {
                background-color: #374151 !important;
            }

            body.dark-mode .text-gray-700 {
                color: #e5e7eb !important;
            }

            body.dark-mode .border-purple-500 {
                border-color: #a78bfa !important;
            }

            body.dark-mode #canvas_pods {
                filter: invert(1) hue-rotate(180deg);
            }

            body.dark-mode #canvas_pod_cpu_usage {
                filter: invert(1) hue-rotate(180deg);
            }

            body.dark-mode #canvas_unmet_cpu_load {
                filter: invert(1) hue-rotate(180deg);
            }

            /* ADI√á√ÉO: Estilos para controles em dark mode */
            body.dark-mode .control-item {
                background-color: #374151 !important;
            }

            body.dark-mode .control-item label {
                color: #e5e7eb !important;
            }

            body.dark-mode .control-item input[type="number"] {
                background-color: #1f2937 !important;
                color: #e5e7eb !important;
                border-color: #4b5563 !important;
            }

            body.dark-mode .control-item input[type="number"]:focus {
                outline: 2px solid #a78bfa !important;
                outline-offset: 2px;
            }

            body.dark-mode .control-item input[type="range"] {
                accent-color: #a78bfa;
            }

            #darkModeToggle {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                background: #667eea;
                color: white;
                border: none;
                border-radius: 20px;
                cursor: pointer;
                font-weight: 600;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                transition: all 0.3s;
                z-index: 1000;
            }

            #darkModeToggle:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }

            body.dark-mode #darkModeToggle {
                background: #a78bfa;
            }
        </style>
    </head>
    <body class="bg-gradient-to-br from-purple-600 to-indigo-700 min-h-screen p-8">
        <button id="darkModeToggle" onclick="toggleDarkMode()">üåô Dark Mode</button>
        
        <div class="max-w-7xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <!-- Header -->
                <div class="text-center mb-8">
                    <h1 id="title" class="text-5xl font-bold text-purple-600 mb-4">üöÄ HPA Demo</h1>
                    <!-- <p class="text-lg text-gray-600 max-w-3xl mx-auto" -->
                        <p class="text-lg"></p>
                        <span class="font-bold">hpademo</span> is a simple demo for Kubernetes Horizontal Pod Autoscaler (HPA), 
                        written in Go and compiled to WebAssembly.
                    </p>
                </div>

                <!-- Links -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-8 rounded">
                    <div class="flex flex-col md:flex-row justify-center gap-4 text-center">
                        <div>
                            <span class="font-semibold">üåê Online:</span>
                            <a href="https://udhos.github.io/hpademo/www" class="text-blue-600 hover:text-blue-800 hover:underline ml-2">
                                udhos.github.io/hpademo/www
                            </a>
                        </div>
                        <div>
                            <span class="font-semibold">üíª Source:</span>
                            <a href="https://github.com/udhos/hpademo" class="text-blue-600 hover:text-blue-800 hover:underline ml-2">
                                github.com/udhos/hpademo
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Demo Area -->
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <!-- Canvas Area -->

                    <div class="lg:col-span-3">
                        <!-- Replicas Chart -->
                        <div class="text-lg font-bold text-gray-700 mb-4">Replicas</div>
                        <div class="bg-white border-2 border-purple-500 rounded-xl shadow-lg p-2">
                            <canvas id="canvas_pods" width="1000" height="200" class="w-full rounded-lg"></canvas>
                        </div>
                        <center><div id="canvas_pods_legend"></div></center>

                        <!-- Pod CPU Usage Chart -->
                        <div class="text-lg font-bold text-gray-700 mb-4">Per-Pod CPU Usage</div>
                        <div class="bg-white border-2 border-purple-500 rounded-xl shadow-lg p-2">
                            <canvas id="canvas_pod_cpu_usage" width="1000" height="200" class="w-full rounded-lg"></canvas>
                        </div>
                        <center><div id="canvas_pod_cpu_usage_legend"></div></center>

                        <!-- Unmet CPU Load Chart -->
                        <div class="text-lg font-bold text-gray-700 mb-4">Total Unmet CPU Load</div>
                        <div class="bg-white border-2 border-purple-500 rounded-xl shadow-lg p-2">
                            <canvas id="canvas_unmet_cpu_load" width="1000" height="200" class="w-full rounded-lg"></canvas>
                        </div>
                        <!-- Center legend -->
                        <center><div id="canvas_unmet_cpu_load_legend"></div></center>

                    </div>

                    <!-- Controls Area -->
                    <div class="lg:col-span-1">
                        <div class="bg-gray-50 rounded-xl shadow-lg p-4">
                            <div id="controls"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>